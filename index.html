<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight Schedule</title>
    <style>
        :root {
            --ana-blue-dark: #002D5A;
            --ana-blue-main: #004482;
            --ana-blue-sky: #0076cb;
            --ana-gradient: linear-gradient(135deg, #004482 0%, #0076cb 100%);
            --bg-gray: #f2f4f7;
            --plane-body: #ffffff;
            --plane-wing: #dce1e6;
            --text-main: #333;
            --danger: #d93025;
            --success: #1e8e3e;
            --gold: #d4af37;
            --diamond: #b9f2ff;
        }

        body {
            font-family: "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif;
            background-color: var(--bg-gray);
            margin: 0; padding: 0; color: var(--text-main);
            -webkit-tap-highlight-color: transparent;
        }

        /* Header */
        header {
            background-color: var(--ana-blue-dark);
            color: white; padding: 15px 20px; 
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .header-left { display: flex; flex-direction: column; }
        .header-title { font-size: 1.2rem; font-weight: bold; }
        .mile-display { font-size: 0.8rem; color: var(--gold); font-weight: bold; margin-top: 2px; }
        .status-badge-header { font-size: 0.6rem; padding: 1px 5px; border-radius: 3px; margin-left: 5px; vertical-align: middle; }
        .st-BRONZE { background: #cd7f32; color: white; }
        .st-SAPPHIRE { background: #0f52ba; color: white; }
        .st-DIAMOND { background: var(--diamond); color: #004482; }
        .header-icon { font-size: 1.5rem; cursor: pointer; }

        .container { padding: 15px; max-width: 600px; margin: 0 auto; padding-bottom: 100px; }

        /* Flight Card */
        .flight-card {
            background: white; border-radius: 12px; margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); position: relative;
            overflow: hidden; border-top: 4px solid var(--ana-blue-main);
        }

        .noshow-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.7); display: flex;
            justify-content: center; align-items: center; z-index: 5; pointer-events: none;
        }
        .noshow-stamp {
            border: 4px solid var(--danger); color: var(--danger);
            padding: 10px 30px; font-size: 2rem; font-weight: 900;
            transform: rotate(-15deg); border-radius: 8px; background: white;
        }

        .card-inner { padding: 15px; }
        .route-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .city-box { text-align: center; width: 80px; }
        .city-code { font-size: 2rem; font-weight: 800; color: var(--ana-blue-dark); letter-spacing: 1px; line-height: 1; }
        .city-name { font-size: 0.7rem; color: #777; margin-top: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .time-row {
            display: flex; justify-content: space-between; 
            background: #f4f7fa; padding: 10px; border-radius: 8px; margin-bottom: 10px;
        }
        .time-box { text-align: center; flex: 1; }
        .time-label { font-size: 0.7rem; color: #666; font-weight: bold; }
        .time-value { font-size: 1.2rem; font-weight: bold; color: #333; }
        .duration-center { font-size: 0.8rem; color: #999; align-self: center; }

        .status-badge { padding: 4px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: bold; color: white; background: #999; }
        .badge-reserved { background: var(--ana-blue-sky); }
        .badge-checkin { background: var(--success); }
        .badge-noshow { background: var(--danger); }
        .badge-inflight { background: var(--ana-blue-main); animation: pulse 2s infinite; }
        .badge-arrived { background: var(--gold); }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }

        .boarding-pass { background: #f9f9f9; border-top: 1px dashed #ddd; padding: 12px; font-size: 0.8rem; }
        .mile-tag { color: var(--gold); font-weight: bold; font-size: 0.7rem; text-align: right; margin-top: 5px; }

        /* Modal */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 45, 90, 0.85); z-index: 1000; backdrop-filter: blur(5px);
        }
        .modal-content {
            background: #f0f3f6; width: 95%; max-width: 480px; height: auto; max-height: 90vh;
            margin: 5vh auto; border-radius: 16px; overflow: hidden; display: flex; flex-direction: column;
        }
        .modal-header-ana { background: var(--ana-gradient); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .modal-body { flex: 1; overflow-y: auto; padding: 20px; position: relative; }
        .modal-footer { background: white; padding: 15px; border-top: 1px solid #ddd; }

        /* Inputs */
        .form-group { margin-bottom: 15px; background: white; padding: 15px; border-radius: 8px; }
        .form-group label { display: block; font-size: 0.75rem; color: #666; margin-bottom: 8px; }
        select, input { 
            width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; 
            box-sizing: border-box; font-size: 1rem; background: #fff;
            -webkit-appearance: none; appearance: none;
        }

        /* Settings List */
        .airport-list { list-style: none; padding: 0; margin: 0; }
        .airport-item { 
            background: white; padding: 15px; margin-bottom: 10px; border-radius: 8px; 
            display: flex; justify-content: space-between; align-items: center;
        }
        .airport-code-tag { background: var(--ana-blue-sky); color: white; padding: 4px 8px; border-radius: 4px; font-weight: bold; margin-right: 10px; }
        .delete-btn { color: var(--danger); background: none; border: none; font-size: 1.2rem; cursor: pointer; }

        /* Seat Map Elements */
        .plane-wrapper { position: relative; width: 280px; margin: 20px auto; padding-top: 60px; padding-bottom: 60px; }
        .fuselage { background: var(--plane-body); width: 100%; height: 100%; border-radius: 140px 140px 80px 80px; position: absolute; top: 0; left: 0; z-index: 1; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 1px solid #e0e0e0; }
        .cockpit { position: absolute; top: 30px; left: 50%; transform: translateX(-50%); width: 50px; height: 20px; background: linear-gradient(to bottom, #333, #666); border-radius: 40% 40% 50% 50%; z-index: 2; }
        .wing-left, .wing-right { position: absolute; top: 300px; width: 100px; height: 180px; background: var(--plane-wing); z-index: 0; border: 1px solid #ccc; }
        .wing-left { left: -80px; transform: skewY(15deg); border-radius: 10% 0 0 80%; }
        .wing-right { right: -80px; transform: skewY(-15deg); border-radius: 0 10% 80% 0; }
        .seat-map-container { position: relative; z-index: 10; padding: 20px 10px; }
        .seat-row { display: flex; justify-content: center; gap: 5px; margin-bottom: 6px; }
        .aisle-gap { width: 20px; display: flex; align-items: center; justify-content: center; font-size: 0.6rem; color: #ccc; }
        .seat { width: 28px; height: 28px; background: #eef2f6; border: 1px solid #ccd1d6; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 0.6rem; color: #666; cursor: pointer; }
        .seat.selected { background: var(--ana-blue-main); color: white; }

        /* Buttons */
        .btn { width: 100%; padding: 14px; border: none; border-radius: 30px; font-weight: bold; cursor: pointer; text-align: center; }
        .btn-save { background: var(--ana-blue-dark); color: white; }
        .btn-add { background: var(--success); color: white; margin-top: 10px; }
        .btn-checkin { background: var(--success); color: white; padding: 10px; border-radius: 8px; margin-top: 10px; width: 100%; }
        .btn-disabled { background: #ccc !important; cursor: not-allowed; }

        .fab { position: fixed; bottom: 30px; right: 25px; width: 65px; height: 65px; background: var(--ana-gradient); color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 2.2rem; box-shadow: 0 8px 20px rgba(0,68,130,0.4); border: none; cursor: pointer; z-index: 90; }
        .in-app-banner {
        position: fixed; top: -100px; left: 0; width: 100%;
        background: var(--ana-blue-main); color: white;
        padding: 15px; text-align: center; font-weight: bold;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        transition: top 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        z-index: 2000; display: flex; align-items: center; justify-content: center; gap: 10px;
        cursor: pointer;
    }
    .in-app-banner.show { top: 0; }
    .swipe-container {
        position: relative;
        width: 100%;
        height: 50px;
        background: #eee;
        border-radius: 25px;
        margin-top: 15px;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #777;
        font-size: 0.8rem;
        font-weight: bold;
    }

    .swipe-handle {
        position: absolute;
        left: 0;
        top: 0;
        width: 60px;
        height: 50px;
        background: var(--ana-gradient);
        border-radius: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
        z-index: 10;
        cursor: grab;
        touch-action: none;
    }

    /* åˆ‡ã‚Šé›¢ã—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    .stub-tear {
        animation: tear-off 0.6s forwards ease-out;
    }

    @keyframes tear-off {
        0% { transform: rotate(0deg) translateY(0); opacity: 1; }
        30% { transform: rotate(5deg) translateY(10px); opacity: 1; }
        100% { transform: rotate(15deg) translateY(100px); opacity: 0; }
    }
    /* ã‚¿ãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.tab-container {
    display: flex;
    background: white;
    border-bottom: 1px solid #ddd;
    position: sticky;
    top: 60px; /* ãƒ˜ãƒƒãƒ€ãƒ¼ã®é«˜ã•ã«åˆã‚ã›ã¦èª¿æ•´ */
    z-index: 99; /* ãƒ˜ãƒƒãƒ€ãƒ¼(100)ã®ã™ãä¸‹ */
}

.tab-btn {
    flex: 1;
    text-align: center;
    padding: 15px;
    font-size: 0.9rem;
    font-weight: bold;
    color: #999;
    cursor: pointer;
    transition: all 0.3s;
    border-bottom: 3px solid transparent;
}

.tab-btn.active {
    color: var(--ana-blue-main);
    border-bottom: 3px solid var(--ana-blue-main);
    background: rgba(0, 68, 130, 0.05);
}
    /* éå»ã®ãƒã‚±ãƒƒãƒˆç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    .flight-card.history {
    border-top: 4px solid #999; /* å±¥æ­´ã¯é’ã§ã¯ãªãã‚°ãƒ¬ãƒ¼ã®ç·šã« */
}

/* å±¥æ­´ã‚«ãƒ¼ãƒ‰å†…ã®ç‰¹å®šã®è¦ç´ ã ã‘ã‚’ç™½é»’ãƒ»è–„ãã™ã‚‹ */
.flight-card.history .city-code, 
.flight-card.history .time-value,
.flight-card.history .route-row,
.flight-card.history .time-row {
    filter: grayscale(1);
    opacity: 0.6;
}

.boarding-pass {
    background: white;
    color: #333;
    border-radius: 12px;
    padding: 20px;
    margin-top: 15px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    position: relative;
    border: 1px solid #eee;
}

/* 2æ¬¡å…ƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰ */
.qr-placeholder {
    width: 140px;
    height: 140px;
    background: #f5f5f5;
    margin: 10px auto 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid #ddd;
    border-radius: 8px;
}

/* æƒ…å ±è¡¨ç¤ºãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
.pass-info-grid {
    display: grid;
    grid-template-columns: 1fr 1fr; /* 2åˆ—ã«ã—ã¦å¤§ããè¦‹ã›ã‚‹ */
    gap: 20px;
    text-align: center;
    border-top: 1px dashed #ccc;
    padding-top: 20px;
}

.pass-label {
    font-size: 0.65rem;
    color: #888;
    margin-bottom: 4px;
    font-weight: bold;
}

.pass-value {
    font-size: 1.1rem;
    font-weight: bold;
    color: #000;
}

/* ã‚°ãƒ«ãƒ¼ãƒ—ç•ªå·ã®å¼·èª¿ */
.group-badge {
    background: #000;
    color: #fff;
    padding: 2px 8px;
    border-radius: 4px;
    display: inline-block;
}

.seat-highlight {
    font-size: 2.5rem; /* ã‹ãªã‚Šå¤§ãã */
    font-weight: bold;
    color: var(--ana-blue-main);
    line-height: 1;
    margin: 10px 0;
}

/* æ­ä¹—åˆ¸ã®ã‚³ãƒ³ãƒ†ãƒŠï¼ˆæœ€åˆã¯éš ã™ï¼‰ */
.boarding-pass-container {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

/* é–‹ã„ãŸæ™‚ã®çŠ¶æ…‹ */
.boarding-pass-container.open {
    max-height: 500px; /* ååˆ†ãªé«˜ã•ã‚’æŒ‡å®š */
}

/* é–‹é–‰ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.toggle-pass-btn {
    width: 100%;
    background: #f8f9fa;
    border: 1px dashed var(--ana-blue-main);
    color: var(--ana-blue-main);
    padding: 10px;
    border-radius: 8px;
    margin-top: 10px;
    font-size: 0.8rem;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 5px;
}

.toggle-pass-btn::after {
    content: 'â–¼';
    font-size: 0.6rem;
    transition: transform 0.3s;
}

.toggle-pass-btn.active::after {
    transform: rotate(180deg);
}
.focus-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px); /* èƒŒæ™¯ã‚’å°‘ã—ã¼ã‹ã™ */
    z-index: 900;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.4s;
}

.focus-overlay.active {
    opacity: 1;
    pointer-events: auto;
}

/* æ­ä¹—åˆ¸ãŒãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã•ã‚ŒãŸæ™‚ã®å¼·èª¿ */
.boarding-pass-container.open {
    position: relative;
    z-index: 1000; /* æš—å¹•ã‚ˆã‚Šä¸Šã«è¡¨ç¤º */
}

.boarding-pass-container.open .boarding-pass {
    box-shadow: 0 0 30px rgba(255, 255, 255, 0.2);
    transform: scale(1.02); /* ã»ã‚“ã®å°‘ã—ã ã‘å¤§ããã—ã¦æµ®éŠæ„Ÿã‚’å‡ºã™ */
    transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
    </style>
</head>
<body>
<div id="focusOverlay" class="focus-overlay" onclick="closeAllPasses()"></div>
<header>
    <div class="header-left">
        <div class="header-title">Flight Schedule <span id="statusLabel" class="status-badge-header"></span></div>
        <div class="mile-display">âœˆ <span id="totalMiles">0</span> MILES</div>
    </div>
    <div style="display:flex; gap:15px; align-items:center;">
        <span id="notifBtn" onclick="requestNotification()" style="cursor:pointer; font-size:1.2rem; filter:grayscale(1);">ğŸ””</span>
        <div class="header-icon" onclick="openAirportModal()">âš™ï¸</div>
    </div>
    <div id="notifBanner" class="in-app-banner" onclick="hideBanner()">
    <span>âœˆ</span> <span id="notifText">æ­ä¹—æ‰‹ç¶šããŒå¯èƒ½ãªä¾¿ãŒã‚ã‚Šã¾ã™</span>
</div>
</header>

<div class="tab-container">
    <div id="tab-upcoming" class="tab-btn active" onclick="switchTab('upcoming')">Upcoming</div>
    <div id="tab-history" class="tab-btn" onclick="switchTab('history')">History</div>
</div>

<div class="container" id="flightList"></div>

<button class="fab" onclick="openNewFlightModal()">+</button>

<div id="newFlightModal" class="modal">
    <div class="modal-content">
        <div class="modal-header-ana">
            <strong>ãƒ•ãƒ©ã‚¤ãƒˆäºˆç´„</strong>
            <span onclick="closeModal('newFlightModal')" style="cursor:pointer; font-size:1.5rem">Ã—</span>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>æ­ä¹—ã‚¯ãƒ©ã‚¹ (ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥)</label>
                <select id="classSelect">
                    <option value="ECONOMY">æ™®é€šå¸­ (Economy)</option>
                    <option value="BUSINESS" id="optPremium" disabled>ãƒ“ã‚¸ãƒã‚¹ã‚¯ãƒ©ã‚¹ (Sapphireä»¥ä¸Š)</option>
                    <option value="FIRST" id="optFirst" disabled>ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ (Diamondé™å®š)</option>
                </select>
            </div>
            <div class="form-group">
                <label>åŒºé–“é¸æŠ</label>
                <div style="display:flex; gap:10px; align-items: center;">
                    <div style="flex:1"><label style="font-size:0.6rem">FROM</label><select id="fromSelect"></select></div>
                    <div style="color:var(--ana-blue-sky)">âœˆ</div>
                    <div style="flex:1"><label style="font-size:0.6rem">TO</label><select id="toSelect"></select></div>
                </div>
            </div>
            <div class="form-group">
                <label>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</label>
                <div style="display:flex; gap:10px;">
                    <div class="input-group">
                        <label>æ­ä¹—æ—¥</label>
                        <input type="date" id="flightDate" value="${new Date().toISOString().split('T')[0]}">
                    </div>
                    <div style="flex:1"><label style="font-size:0.6rem">å‡ºç™ºæ™‚åˆ»</label><input type="time" id="timeInput"></div>
                    <div style="flex:1"><label style="font-size:0.6rem">æ‰€è¦æ™‚é–“ (åˆ†)</label><input type="number" id="durationInput" value="60"></div>
                </div>
            </div>
            <div class="form-group" onclick="openSeatMap()" style="cursor:pointer; display:flex; justify-content:space-between; align-items:center;">
                <div><label>åº§å¸­æŒ‡å®š</label><span id="seatLabel" style="font-weight:bold; color:var(--ana-blue-main);">æœªæŒ‡å®š</span></div>
                <div style="color:var(--ana-blue-sky)">é¸æŠ &gt;</div>
            </div>
        </div>
        <div class="modal-footer"><button class="btn btn-save" onclick="saveFlight()">äºˆç´„ç¢ºå®š</button></div>
    </div>
</div>

<div id="airportModal" class="modal">
    <div class="modal-content">
        <div class="modal-header-ana"><strong>ãƒã‚¤ç©ºæ¸¯(ã‚„ã‚‹ã“ã¨)è¨­å®š</strong><span onclick="closeModal('airportModal')" style="cursor:pointer; font-size:1.5rem">Ã—</span></div>
        <div class="modal-body">
            <div class="form-group">
                <div style="display:flex; gap:10px;"><input type="text" id="newAirportCode" placeholder="3ãƒ¬ã‚¿ãƒ¼" maxlength="3" style="flex:1; text-transform:uppercase;"><input type="text" id="newAirportName" placeholder="åç§°" style="flex:2;"></div>
                <button class="btn btn-add" onclick="addAirport()">è¿½åŠ ç™»éŒ²</button>
            </div>
            <ul class="airport-list" id="airportListUi"></ul>
        </div>
    </div>
</div>

<div id="seatModal" class="modal">
    <div class="modal-content" style="height:90vh;">
        <div class="modal-header-ana"><strong>åº§å¸­æŒ‡å®š</strong><span onclick="confirmSeat()" style="cursor:pointer">æ±ºå®š</span></div>
        <div class="modal-body" style="background: #dce1e6;">
            <div class="plane-wrapper" id="planeWrapper"><div class="wing-left"></div><div class="wing-right"></div><div class="fuselage"><div class="cockpit"></div></div><div class="seat-map-container" id="seatGrid"></div></div>
        </div>
    </div>
</div>

<script>
    const defaultAirports = [{code: 'HME', name: 'è‡ªå®…'}, {code: 'WRK', name: 'ä»•äº‹'}, {code: 'CFE', name: 'ã‚«ãƒ•ã‚§'}];
    let airports = JSON.parse(localStorage.getItem('my_airports') || JSON.stringify(defaultAirports));
    let flights = JSON.parse(localStorage.getItem('ana_flights_final') || '[]');
    let tempSeat = null;
    let notifiedFlights = new Set();
    let bannerShownFor = new Set();
    
    // ã‚¹ãƒ¯ã‚¤ãƒ—ç”¨å¤‰æ•°
    let startX = 0;
    let currentX = 0;
    let isDragging = false;
    let currentTab = 'upcoming'; // ã‚¿ãƒ–çŠ¶æ…‹ã®ç®¡ç†

    // --- Status & Mile Logic ---
    function getStatusInfo() {
        const total = flights.reduce((acc, f) => getStatus(f) === 'ARRIVED' ? acc + (f.duration || 0) : acc, 0);
        let status = 'BRONZE';
        if (total >= 3000) status = 'DIAMOND';
        else if (total >= 1000) status = 'SAPPHIRE';
        return { total, status };
    }

    function updateHeader() {
        const info = getStatusInfo();
        document.getElementById('totalMiles').innerText = info.total.toLocaleString();
        const label = document.getElementById('statusLabel');
        label.innerText = info.status;
        label.className = 'status-badge-header st-' + info.status;
        document.getElementById('optPremium').disabled = info.total < 1000;
        document.getElementById('optFirst').disabled = info.total < 3000;
    }

    function getStatus(f) {
    const now = new Date();
    // f.date (2026-02-03) ã¨ f.time (19:30) ã‚’çµ„ã¿åˆã‚ã›ã¦ Date ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
    const [y, m, d] = (f.date || new Date().toISOString().split('T')[0]).split('-').map(Number);
    const [hh, mm] = f.time.split(':').map(Number);
    
    const dep = new Date(y, m - 1, d, hh, mm);
    const arr = new Date(dep.getTime() + (f.duration || 60) * 60000); 
    
    if (now > arr) return 'ARRIVED'; 
    if (now > dep && !f.checkedIn) return 'NOSHOW'; 
    if (now > dep && f.checkedIn) return 'INFLIGHT';
    return f.checkedIn ? 'CHECKEDIN' : 'RESERVED';
}

    function isCheckInOpen(f) {
    const now = new Date();
    const [y, m, d] = (f.date || new Date().toISOString().split('T')[0]).split('-').map(Number);
    const [hh, mm] = f.time.split(':').map(Number);
    
    const dep = new Date(y, m - 1, d, hh, mm);
    const openTime = new Date(dep.getTime() - 10 * 60000); // 10åˆ†å‰
    return now >= openTime && now <= dep;
}

    // --- Tab Switching ---
    function switchTab(tab) {
        currentTab = tab;
        document.getElementById('tab-upcoming').classList.toggle('active', tab === 'upcoming');
        document.getElementById('tab-history').classList.toggle('active', tab === 'history');
        render(); // å†æç”»
    }

    // --- Swipe UI Logic ---
    function getCheckInUI(f, canCheckIn) {
        if (!canCheckIn) {
            return `<div class="swipe-container" style="opacity:0.5; background:#ccc; color:#666">å‡ºç™º10åˆ†å‰ã‹ã‚‰å—ä»˜é–‹å§‹</div>`;
        }
        return `
            <div class="swipe-container" id="swipeContainer-${f.id}">
                <div class="swipe-handle" 
                     onmousedown="handleSwipeStart(event, ${f.id})"
                     ontouchstart="handleSwipeStart(event, ${f.id})">âœˆ</div>
                ã‚¹ãƒ¯ã‚¤ãƒ—ã—ã¦ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³
            </div>
        `;
    }

    function handleSwipeStart(e, id) {
        startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
        isDragging = true;
        const handle = e.target;
        handle.style.transition = 'none';

        const moveHandler = (ev) => handleSwipeMove(ev, id);
        const endHandler = () => {
            handleSwipeEnd(id);
            window.removeEventListener('mousemove', moveHandler);
            window.removeEventListener('touchmove', moveHandler);
            window.removeEventListener('mouseup', endHandler);
            window.removeEventListener('touchend', endHandler);
        };

        window.addEventListener('mousemove', moveHandler);
        window.addEventListener('touchmove', moveHandler, { passive: false });
        window.addEventListener('mouseup', endHandler);
        window.addEventListener('touchend', endHandler);
    }

    function handleSwipeMove(e, id) {
        if (!isDragging) return;
        if (e.cancelable) e.preventDefault();
        const container = document.getElementById(`swipeContainer-${id}`);
        const handle = container.querySelector('.swipe-handle');
        const maxMove = container.offsetWidth - handle.offsetWidth;
        const x = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
        currentX = x - startX;
        if (currentX < 0) currentX = 0;
        if (currentX > maxMove) currentX = maxMove;
        handle.style.transform = `translateX(${currentX}px)`;
        container.style.background = `rgba(0, 68, 130, ${0.1 + (currentX/maxMove) * 0.2})`;
    }

    function handleSwipeEnd(id) {
        if (!isDragging) return;
        isDragging = false;
        const container = document.getElementById(`swipeContainer-${id}`);
        const handle = container.querySelector('.swipe-handle');
        const maxMove = container.offsetWidth - handle.offsetWidth;
        if (currentX >= maxMove * 0.9) {
            handle.style.transition = 'transform 0.2s';
            handle.style.transform = `translateX(${maxMove}px)`;
            setTimeout(() => {
                if (window.navigator.vibrate) window.navigator.vibrate(30);
                doCheckIn(id);
            }, 200);
        } else {
            handle.style.transition = 'transform 0.3s ease';
            handle.style.transform = 'translateX(0)';
            container.style.background = '#eee';
        }
        currentX = 0;
    }

    // --- Render ---
    function render() {
    updateHeader();
    const list = document.getElementById('flightList');
    
    const displayFlights = flights.filter(f => {
        const status = getStatus(f);
        const isHistory = (status === 'ARRIVED' || status === 'NOSHOW');
        return currentTab === 'upcoming' ? !isHistory : isHistory;
    });

    let summaryHtml = '';
    if (currentTab === 'history' && displayFlights.length > 0) {
        const totalFlights = displayFlights.length;
        const arrivedCount = displayFlights.filter(f => getStatus(f) === 'ARRIVED').length;
        const noshowCount = displayFlights.filter(f => getStatus(f) === 'NOSHOW').length;
        const totalMinutes = displayFlights
    .filter(f => getStatus(f) === 'ARRIVED')
    .reduce((sum, f) => sum + Number(f.duration), 0);

        // åˆ†ã‚’ã€Œæ—¥ãƒ»æ™‚é–“ãƒ»åˆ†ã€ã«å¤‰æ›
        const days = Math.floor(totalMinutes / 1440);
        const hours = Math.floor((totalMinutes % 1440) / 60);
        const mins = totalMinutes % 60;

        // è¡¨ç¤ºç”¨ã®ãƒ†ã‚­ã‚¹ãƒˆä½œæˆ
        let timeStr = "";
        if (days > 0) timeStr += `${days}d `;
        timeStr += `${hours}h ${mins}m`;
        
        // æœ€å¤šè·¯ç·šã®ç®—å‡ºãƒ­ã‚¸ãƒƒã‚¯
        const routes = displayFlights.map(f => `${f.from} âœˆ ${f.to}`);
        const mostFrequentRoute = routes.sort((a,b) =>
              routes.filter(v => v===a).length - routes.filter(v => v===b).length
        ).pop();

        let rankTitle = "BEGINNER";
        let rankColor = "#fff"; // åŸºæœ¬ã¯ç™½
        if (totalMinutes >= 6000) {
            rankTitle = "SKY LEGEND";
            rankColor = "var(--gold)"; // ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰ã¯é‡‘
        } else if (totalMinutes >= 1440) {
            rankTitle = "CLOUD DWELLER"; // é›²ã®ä½äºº
            rankColor = "#e5e4e2"; // ãƒ—ãƒ©ãƒãƒŠï¼ˆã‚·ãƒ«ãƒãƒ¼ï¼‰
        } else if (totalMinutes >= 600) {
            rankTitle = "SKY RUNNER";
            rankColor = "#87ceeb"; // ã‚¹ã‚«ã‚¤ãƒ–ãƒ«ãƒ¼
        }

        summaryHtml = `
    <div style="background: var(--ana-gradient); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,68,130,0.2); position: relative; overflow: hidden;">
        <div style="position: absolute; right: -10px; bottom: -10px; font-size: 5rem; opacity: 0.1; transform: rotate(-20deg);">âœˆ</div>
        
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
            <div style="font-size: 0.75rem; opacity: 0.8; letter-spacing: 1.5px;">TOTAL AIR TIME</div>
            <div style="font-size: 0.7rem; font-weight: bold; background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 4px; color: ${rankColor}; border: 1px solid ${rankColor}55;">
                ${rankTitle}
            </div>
        </div>

        <div style="font-size: 2.2rem; font-weight: bold; font-family: sans-serif; margin-bottom: 15px;">
            ${timeStr}
        </div>

        <div style="display: flex; justify-content: space-between; align-items: flex-end; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 10px;">
            <div>
                <div style="font-size: 0.7rem; opacity: 0.8;">æ­ä¹—å›æ•°</div>
                <div style="font-size: 1.1rem; font-weight: bold;">${totalFlights} <span style="font-size: 0.7rem;">å›</span></div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 0.7rem; opacity: 0.8;">å®šæ™‚æ­ä¹—ç‡</div>
                <div style="font-size: 1.1rem; font-weight: bold;">${Math.round((arrivedCount/totalFlights)*100)}%</div>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 0.7rem; opacity: 0.8;">ç´¯è¨ˆãƒã‚¤ãƒ«</div>
                <div style="font-size: 1.1rem; font-weight: bold; color: var(--gold);">${totalMinutes.toLocaleString()}</div>
            </div>
        </div>
    </div>
`;
    }

    if(displayFlights.length === 0) {
        list.innerHTML = summaryHtml + `<div style="text-align:center; color:#999; margin-top:50px">
            ${currentTab === 'upcoming' ? 'ã“ã‚Œã‹ã‚‰ã®äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“' : 'æ­ä¹—å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“'}
        </div>`;
        return;
    }

    // 3. ä¸¦ã³æ›¿ãˆ
    displayFlights.sort((a,b) => currentTab === 'upcoming' 
        ? a.time.localeCompare(b.time) 
        : b.time.localeCompare(a.time));

    // 4. æç”»ï¼ˆã“ã“ãŒã‚¨ãƒ©ãƒ¼ã®ç®‡æ‰€ã§ã™ï¼‰
    // summaryHtml ã‚’å…ˆé ­ã«ç½®ãã€ãã®å¾Œã«å„ãƒ•ãƒ©ã‚¤ãƒˆã®ã‚«ãƒ¼ãƒ‰ã‚’çµåˆã—ã¾ã™
    list.innerHTML = summaryHtml + displayFlights.map(f => {
        const status = getStatus(f);
    const canCheckIn = isCheckInOpen(f);
    const isHistory = (status === 'ARRIVED' || status === 'NOSHOW');
    
    // ã€è¿½åŠ ï¼šæ—¥ä»˜ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå‡¦ç†ã€‘
    // ãƒ‡ãƒ¼ã‚¿ã® f.date (2026-02-03) ã‚’èª­ã¿è¾¼ã‚“ã§ã€è¡¨ç¤ºç”¨ã®æ–‡å­—åˆ—ï¼ˆ2æœˆ3æ—¥(ç«)ï¼‰ã‚’ä½œã‚Šã¾ã™
    const dateObj = new Date(f.date || new Date());
    const dateStr = dateObj.toLocaleDateString('ja-JP', { 
        month: 'short', 
        day: 'numeric', 
        weekday: 'short' 
    });

    const [h, m] = f.time.split(':').map(Number);
    // æ—¥ä»˜ã‚‚è€ƒæ…®ã—ã¦åˆ°ç€æ™‚åˆ»ã‚’è¨ˆç®—
    const depDate = new Date(dateObj); 
    depDate.setHours(h, m, 0, 0);
    const arrDate = new Date(depDate.getTime() + f.duration * 60000);
    const arrTimeStr = arrDate.getHours().toString().padStart(2,'0') + ':' + arrDate.getMinutes().toString().padStart(2,'0');
        

        return `
        <div class="flight-card ${isHistory ? 'history' : ''}" data-id="${f.id}">
            ${status === 'NOSHOW' ? '<div class="noshow-overlay"><div class="noshow-stamp">NO SHOW</div></div>' : ''}
            ${status === 'ARRIVED' ? '<div class="noshow-overlay"><div class="noshow-stamp" style="border-color:var(--gold); color:var(--gold);">ARRIVED</div></div>' : ''}
            
            <div class="card-inner">
                <div style="font-size: 0.75rem; color: var(--ana-blue-main); font-weight: bold; margin-bottom: 8px; display: flex; align-items: center; gap: 5px;">
                    <span style="font-size: 0.9rem;">ğŸ“…</span> ${dateStr}
                </div>

                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <span class="status-badge badge-${status.toLowerCase()}">${status}</span>
                    <span style="font-size:0.8rem; color:#999">#${String(f.id).slice(-4)}</span>
                </div>
                    
                    <div class="route-row">
                        <div class="city-box"><div class="city-code">${f.from}</div><div class="city-name">${f.fromName}</div></div>
                        <div style="color:var(--ana-blue-sky)">âœˆ</div>
                        <div class="city-box"><div class="city-code">${f.to}</div><div class="city-name">${f.toName}</div></div>
                    </div>

                    <div class="time-row">
                        <div class="time-box"><div class="time-label">DEP</div><div class="time-value">${f.time}</div></div>
                        <div class="duration-center">â¯ ${f.duration}min â¯</div>
                        <div class="time-box"><div class="time-label">ARR</div><div class="time-value">${arrTimeStr}</div></div>
                    </div>

                    ${isHistory ? `
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:12px; padding-top:10px; border-top:1px dashed #ddd;">
                            <div style="font-size:0.75rem; font-weight:bold; color:${status === 'ARRIVED' ? 'var(--gold)' : '#999'}">
                                ${status === 'ARRIVED' ? `+${f.duration} MILES` : '0 MILES (NO SHOW)'}
                            </div>
                            <button onclick='repeatFlight(${JSON.stringify(f)})' 
                                    style="background: var(--ana-blue-main); color: white; border: none; padding: 8px 16px; border-radius: 20px; font-size: 0.75rem; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(0, 68, 130, 0.3); position: relative; z-index: 10;">
                                å†äºˆç´„ âœˆ
                            </button>
                        </div>
                    ` : ''}

                    ${(status === 'RESERVED' && currentTab === 'upcoming') ? getCheckInUI(f, canCheckIn) : ''}
                </div>

                ${(f.checkedIn && !isHistory) ? `
    <button class="toggle-pass-btn" onclick="toggleBoardingPass(this)">
        æ­ä¹—åˆ¸ã‚’è¡¨ç¤º
    </button>
    <div class="boarding-pass-container">
        <div class="boarding-pass">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                <div>
                    <div style="font-size: 0.65rem; color: #888; font-weight: bold;">BOARDING PASS</div>
                    <div style="font-size: 1.2rem; font-weight: bold; color: var(--ana-blue-main);">${f.from} â†’ ${f.to}</div>
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 0.65rem; color: #888; font-weight: bold;">CLASS</div>
                    <div style="font-size: 0.9rem; font-weight: bold;">${f.boardingClass || 'ECONOMY'}</div>
                </div>
            </div>

            <div style="text-align: center; padding: 10px 0 20px 0;">
                <div style="font-size: 0.65rem; color: #888; font-weight: bold;">ASSIGNED SEAT</div>
                <div style="font-size: 2.8rem; font-weight: bold; color: var(--ana-blue-main); line-height: 1;">${f.seat}</div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; text-align: center; border-top: 1px dashed #ccc; padding-top: 20px;">
                <div>
                    <div style="font-size: 0.65rem; color: #888; font-weight: bold;">GROUP</div>
                    <div style="font-size: 1.2rem; font-weight: bold;"><span style="background: #000; color: #fff; padding: 2px 8px; border-radius: 4px;">3</span></div>
                </div>
                <div>
                    <div style="font-size: 0.65rem; color: #888; font-weight: bold;">GATE</div>
                    <div style="font-size: 1.2rem; font-weight: bold;">T1</div>
                </div>
            </div>
            
            <div style="margin-top: 20px; text-align: center; font-size: 0.65rem; color: #666; background: #f9f9f9; padding: 10px; border-radius: 6px;">
                å‡ºç™ºæ™‚åˆ»ã®<strong>20åˆ†å‰</strong>ã¾ã§ã«ä¿å®‰æ¤œæŸ»å ´ã‚’ã”é€šéãã ã•ã„
            </div>
        </div>
    </div>
        ` : ''}
            </div>
        `;
    }).join('');
}

    // --- Other Functions ---
    function doCheckIn(id) {
        flights = flights.map(f => f.id === id ? {...f, checkedIn: true} : f);
        localStorage.setItem('ana_flights_final', JSON.stringify(flights));
        render();
    }

    function saveFlight() {
    const fromCode = document.getElementById('fromSelect').value;
    const toCode = document.getElementById('toSelect').value;
    const dateVal = document.getElementById('dateInput').value; // è¿½åŠ 
    const fromAp = airports.find(a => a.code === fromCode);
    const toAp = airports.find(a => a.code === toCode);
    
    const f = {
        id: Date.now(),
        date: dateVal || new Date().toISOString().split('T')[0], // è¿½åŠ 
        from: fromCode, 
        fromName: fromAp ? fromAp.name : '',
        to: toCode, 
        toName: toAp ? toAp.name : '',
        time: document.getElementById('timeInput').value,
        duration: parseInt(document.getElementById('durationInput').value) || 60,
        seat: tempSeat || 'ANY',
        boardingClass: document.getElementById('classSelect').value,
        checkedIn: false
    };
    
    if(!f.time || !f.date) return alert('æ—¥ä»˜ã¨æ™‚åˆ»ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    
    flights.push(f);
    localStorage.setItem('ana_flights_final', JSON.stringify(flights));
    closeModal('newFlightModal');
    render();
}

    function initSeatMap() {
        const grid = document.getElementById('seatGrid'); 
        grid.innerHTML = '';
        const selectedClass = document.getElementById('classSelect').value;
        for (let r = 1; r <= 20; r++) {
            let rowClass = (r <= 2) ? 'FIRST' : (r <= 7) ? 'BUSINESS' : 'ECONOMY';
            const isLocked = (rowClass !== selectedClass);
            const row = document.createElement('div'); 
            row.className = 'seat-row';
            if (isLocked) row.style.opacity = "0.3";
            ['A','B','C'].forEach(c => createSeat(row, r, c, isLocked, rowClass));
            const aisle = document.createElement('div'); aisle.className='aisle-gap'; aisle.innerText = r; row.appendChild(aisle);
            ['H','J','K'].forEach(c => createSeat(row, r, c, isLocked, rowClass));
            grid.appendChild(row);
        }
    }

    function createSeat(container, r, c, isLocked, rowClass) {
        const s = document.createElement('div'); 
        s.className = 'seat'; s.innerText = c;
        if (rowClass === 'FIRST') s.style.borderColor = "var(--diamond)";
        if (rowClass === 'BUSINESS') s.style.borderColor = "var(--ana-blue-sky)";
        if (isLocked) {
            s.style.cursor = 'not-allowed';
            s.style.background = '#ddd';
        } else {
            s.onclick = () => { 
                document.querySelectorAll('.seat').forEach(x => x.classList.remove('selected')); 
                s.classList.add('selected'); 
                tempSeat = r + c; 
            };
        }
        container.appendChild(s);
    }

    function requestNotification() {
        if (!("Notification" in window)) return alert("éå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ã§ã™");
        Notification.requestPermission().then(p => {
            if (p === "granted") {
                document.getElementById('notifBtn').style.filter = "none";
                new Notification("é€šçŸ¥è¨­å®šå®Œäº†", { body: "æº–å‚™ãŒæ•´ã„ã¾ã—ãŸã€‚" });
            }
        });
    }

    function sendNotification(f) {
        if (Notification.permission === "granted" && !notifiedFlights.has(f.id)) {
            new Notification("æ­ä¹—æ‰‹ç¶šãã®ã”æ¡ˆå†…", { body: `${f.from} âœˆ ${f.to} ä¾¿ã®å—ä»˜ãŒå§‹ã¾ã‚Šã¾ã—ãŸã€‚` });
            notifiedFlights.add(f.id);
        }
    }

    function showInAppBanner(f) {
        if (bannerShownFor.has(f.id)) return;
        const banner = document.getElementById('notifBanner');
        document.getElementById('notifText').innerText = `æ­ä¹—æ‰‹ç¶šãã®ã”æ¡ˆå†…: ${f.from} âœˆ ${f.to}`;
        banner.classList.add('show');
        setTimeout(hideBanner, 8000);
        bannerShownFor.add(f.id);
    }

    function hideBanner() { document.getElementById('notifBanner').classList.remove('show'); }

    function mainLoop() {
        render(); // 10ç§’ãŠãã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦è‡ªå‹•æŒ¯ã‚Šåˆ†ã‘
        flights.forEach(f => {
            if (getStatus(f) === 'RESERVED' && isCheckInOpen(f)) {
                sendNotification(f);
                showInAppBanner(f);
            }
        });
    }

    function openNewFlightModal() { tempSeat = null; document.getElementById('seatLabel').innerText = 'æœªæŒ‡å®š'; updateHeader(); updateSelectOptions(); document.getElementById('newFlightModal').style.display = 'block'; }
    function openAirportModal() { renderAirportList(); document.getElementById('airportModal').style.display = 'block'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function openSeatMap() { initSeatMap(); document.getElementById('seatModal').style.display = 'block'; }
    function confirmSeat() { if(tempSeat) document.getElementById('seatLabel').innerText = tempSeat; closeModal('seatModal'); }
    function updateSelectOptions() {
        const html = airports.map(a => `<option value="${a.code}">${a.code} - ${a.name}</option>`).join('');
        document.getElementById('fromSelect').innerHTML = html;
        document.getElementById('toSelect').innerHTML = html;
        if(airports.length > 1) document.getElementById('toSelect').selectedIndex = 1;
    }
    function renderAirportList() {
        document.getElementById('airportListUi').innerHTML = airports.map((a, i) => `<li class="airport-item"><span class="airport-code-tag">${a.code}</span><strong>${a.name}</strong><button class="delete-btn" onclick="deleteAirport(${i})">Ã—</button></li>`).join('');
    }
    function addAirport() {
        const c = document.getElementById('newAirportCode').value.toUpperCase();
        const n = document.getElementById('newAirportName').value;
        if(c && n) { airports.push({code:c, name:n}); localStorage.setItem('my_airports', JSON.stringify(airports)); renderAirportList(); }
    }
    function deleteAirport(i) { airports.splice(i, 1); localStorage.setItem('my_airports', JSON.stringify(airports)); renderAirportList(); }

    if (Notification.permission === "granted") document.getElementById('notifBtn').style.filter = "none";
    render();
    setInterval(mainLoop, 10000);

    function repeatFlight(f) {
    // ã‚¿ãƒ–ã‚’ã€Œäºˆå®šã€ã«åˆ‡ã‚Šæ›¿ãˆ
    switchTab('upcoming');
    
    // æ–°è¦äºˆç´„ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
    openNewFlightModal();
    
    // ãƒ‡ãƒ¼ã‚¿ã‚’æµã—è¾¼ã‚€
    setTimeout(() => {
        document.getElementById('fromSelect').value = f.from;
        document.getElementById('toSelect').value = f.to;
        document.getElementById('durationInput').value = f.duration;
        document.getElementById('classSelect').value = f.boardingClass || 'ECONOMY';
        
        // å‰å›ã®åº§å¸­ã‚’ãƒ’ãƒ³ãƒˆã¨ã—ã¦è¡¨ç¤º
        tempSeat = null;
        document.getElementById('seatLabel').innerText = `æœªæŒ‡å®š (å‰å›: ${f.seat})`;
        
        // æ™‚åˆ»ã¯ç¾åœ¨ã®10åˆ†å¾Œã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«ã™ã‚‹
        const now = new Date();
        now.setMinutes(now.getMinutes() + 10);
        const timeStr = now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0');
        document.getElementById('timeInput').value = timeStr;
    }, 100);
}

function toggleBoardingPass(btn) {
    const container = btn.nextElementSibling;
    const overlay = document.getElementById('focusOverlay');
    const isOpen = container.classList.toggle('open');
    
    btn.classList.toggle('active');
    btn.textContent = isOpen ? 'æ­ä¹—åˆ¸ã‚’é–‰ã˜ã‚‹' : 'æ­ä¹—åˆ¸ã‚’è¡¨ç¤º';

    if (isOpen) {
        overlay.classList.add('active');
        // ä»–ã®è¦ç´ ãŒé‡ãªã‚‰ãªã„ã‚ˆã†ã«ã‚«ãƒ¼ãƒ‰ã‚’æœ€å‰é¢ã¸
        btn.parentElement.style.zIndex = "1001";
    } else {
        overlay.classList.remove('active');
        btn.parentElement.style.zIndex = "";
    }
}

// èƒŒæ™¯ã‚’ã‚¿ãƒƒãƒ—ã—ãŸæ™‚ã«é–‰ã˜ã‚‹ç”¨
function closeAllPasses() {
    const openPasses = document.querySelectorAll('.boarding-pass-container.open');
    openPasses.forEach(container => {
        const btn = container.previousElementSibling;
        container.classList.remove('open');
        btn.classList.remove('active');
        btn.textContent = 'æ­ä¹—åˆ¸ã‚’è¡¨ç¤º';
        btn.parentElement.style.zIndex = "";
    });
    document.getElementById('focusOverlay').classList.remove('active');
}
</script>

</body>
</html>
