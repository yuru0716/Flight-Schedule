<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>My Schedule</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: system-ui, -apple-system;
  background: #f7f9fc;
  color: #111;
}

header {
  background: #003b8e;
  color: #fff;
  text-align: center;
  padding: 18px;
  font-weight: 600;
}

main {
  max-width: 420px;
  margin: auto;
  padding: 16px;
}

/* ===== flight card ===== */
.flight {
  position: relative;
  background: #fff;
  border-radius: 14px;
  padding: 16px;
  margin-bottom: 14px;
  box-shadow: 0 2px 8px rgba(0,0,0,.06);
}

.flight-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.title {
  font-size: 16px;
  font-weight: 600;
}

.status {
  font-size: 11px;
  padding: 4px 8px;
  border-radius: 6px;
  background: #e9eef7;
  color: #003b8e;
}

.boarding { background:#fff4da;color:#8a5a00 }
.inflight { background:#e6f4ea;color:#1e6b3a }
.arrived { background:#eee;color:#555 }
.noshow { background:#ffe5e5;color:#b00000 }

/* ===== NO SHOW stamp ===== */
.stamp {
  position: absolute;
  top: 12px;
  left: 12px;
  padding: 6px 12px;
  border: 2px solid #c40000;
  color: #c40000;
  font-weight: 700;
  font-size: 14px;
  transform: rotate(-15deg);
  opacity: .85;
  border-radius: 4px;
}

/* ===== time ===== */
.time-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 14px;
}

.time-block {
  text-align: center;
  flex: 1;
}

.time {
  font-size: 20px;
  font-weight: 600;
}

.label {
  font-size: 11px;
  color: #666;
}

.arrow {
  flex: 0 0 40px;
  text-align: center;
  font-size: 18px;
  color: #003b8e;
}

.sub {
  margin-top: 10px;
  font-size: 12px;
  color: #666;
}

/* ===== progress ===== */
.progress {
  margin-top: 12px;
  height: 6px;
  background: #e6eaf2;
  border-radius: 999px;
  overflow: hidden;
}

.progress-bar {
  height: 100%;
  background: #003b8e;
  transition: width .4s ease;
}

/* ===== action ===== */
.action {
  margin-top: 12px;
}

.action button {
  width: 100%;
  padding: 10px;
  font-size: 14px;
  border-radius: 10px;
  border: none;
  background: #003b8e;
  color: #fff;
  font-weight: 600;
}

.checked {
  margin-top: 12px;
  background: #e6f4ea;
  color: #1e6b3a;
  padding: 10px;
  border-radius: 10px;
  font-size: 13px;
  text-align: center;
}

/* ===== boarding pass ===== */
.ticket {
  margin-top: 14px;
  border-radius: 12px;
  overflow: hidden;
  border: 1px dashed #cfd8ea;
}

.ticket-header {
  background: #003b8e;
  color: white;
  padding: 10px 14px;
  font-size: 12px;
}

.ticket-body {
  padding: 14px;
}

.ticket-route {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 10px;
}

.ticket-info {
  display: flex;
  justify-content: space-between;
  font-size: 12px;
}

.ticket-label {
  font-size: 10px;
  color: #666;
}

.ticket-value {
  font-weight: 600;
}

/* ===== add button ===== */
button.add {
  width: calc(100% - 32px);
  margin: 20px auto;
  display: block;
  padding: 14px;
  border-radius: 12px;
  border: none;
  font-size: 15px;
  background: #003b8e;
  color: white;
  font-weight: 600;
}

/* ===== modal ===== */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.3);
  display: flex;
  justify-content: center;
  align-items: flex-end;
}

.hidden { display: none; }

.sheet {
  background: #fff;
  width: 100%;
  max-width: 420px;
  padding: 20px;
  border-radius: 16px 16px 0 0;
}
</style>
</head>

<body>

<header>MY SCHEDULE</header>
<main id="list"></main>
<button class="add" onclick="openModal()">＋ 予定を追加</button>

<div id="modal" class="modal hidden">
  <div class="sheet">
    <label>出発地<input id="fromInput"></label>
    <label>到着地<input id="toInput"></label>
    <label>出発時刻<input id="timeInput" type="time"></label>
    <label>所要時間（分）<input id="durationInput" type="number"></label>
    <button onclick="submitFlight()">予約する</button>
  </div>
</div>

<script>
const flights = JSON.parse(localStorage.getItem("flights") || "[]");

function openModal(){ modal.classList.remove("hidden"); }
function submitFlight(){
  flights.push({
    id: Date.now(),
    from: fromInput.value,
    to: toInput.value,
    time: timeInput.value,
    duration: Number(durationInput.value),
    checkedIn:false
  });
  modal.classList.add("hidden");
  save(); render();
}

function getState(f){
  const now=new Date();
  const [h,m]=f.time.split(":");
  const dep=new Date(); dep.setHours(h,m,0);
  const arr=new Date(dep.getTime()+f.duration*60000);
  const min=(dep-now)/60000;

  if(now>dep && !f.checkedIn) return "noshow";
  if(now>arr) return "arrived";
  if(now>=dep) return "inflight";
  if(min<=10) return "boarding";
  if(min<=30) return f.checkedIn?"checked":"checkin";
  return "reserved";
}

function checkIn(id){
  const f=flights.find(x=>x.id===id);
  if(!f) return;
  f.checkedIn=true;
  save(); render();
}

function render(){
  list.innerHTML="";
  flights.forEach(f=>{
    const [h,m]=f.time.split(":");
    const dep=new Date(); dep.setHours(h,m,0);
    const arr=new Date(dep.getTime()+f.duration*60000);
    const state=getState(f);

    let action="", ticket="", stamp="";

    if(state==="checkin"){
      action=`<div class="action"><button onclick="checkIn(${f.id})">チェックイン</button></div>`;
    }
    if(state==="checked"){
      action=`<div class="checked">✔ チェックイン済</div>`;
    }
    if(state==="checked"||state==="boarding"||state==="inflight"){
      ticket=`
        <div class="ticket">
          <div class="ticket-header">BOARDING PASS</div>
          <div class="ticket-body">
            <div class="ticket-route">${f.from} → ${f.to}</div>
          </div>
        </div>`;
    }
    if(state==="noshow"){
      stamp=`<div class="stamp">NO SHOW</div>`;
    }

    list.innerHTML+=`
      <div class="flight">
        ${stamp}
        <div class="flight-header">
          <div class="title">${f.from} → ${f.to}</div>
          <div class="status ${state}">${state.toUpperCase()}</div>
        </div>
        ${action}
        ${ticket}
      </div>`;
  });
  save();
}

function save(){
  localStorage.setItem("flights",JSON.stringify(flights));
}

setInterval(render,10000);
render();
</script>

</body>
</html>
