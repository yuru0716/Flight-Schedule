<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>My Schedule</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: system-ui, -apple-system;
  background: #f7f9fc;
  color: #111;
}

header {
  background: #003b8e;
  color: #fff;
  text-align: center;
  padding: 18px;
  font-weight: 600;
}

main {
  max-width: 420px;
  margin: auto;
  padding: 16px;
}

.flight {
  background: #fff;
  border-radius: 14px;
  padding: 16px;
  margin-bottom: 14px;
  box-shadow: 0 2px 8px rgba(0,0,0,.06);
}

.flight-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.title {
  font-size: 16px;
  font-weight: 600;
}

.status {
  font-size: 11px;
  padding: 4px 8px;
  border-radius: 6px;
  background: #e9eef7;
  color: #003b8e;
}

.boarding { background:#fff4da;color:#8a5a00 }
.inflight { background:#e6f4ea;color:#1e6b3a }
.arrived { background:#eee;color:#555 }

.time-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 14px;
}

.time-block {
  text-align: center;
  flex: 1;
}

.time {
  font-size: 20px;
  font-weight: 600;
}

.label {
  font-size: 11px;
  color: #666;
}

.arrow {
  flex: 0 0 40px;
  text-align: center;
  font-size: 18px;
  color: #003b8e;
}

.sub {
  margin-top: 10px;
  font-size: 12px;
  color: #666;
}

/* progress */
.progress {
  margin-top: 12px;
  height: 6px;
  background: #e6eaf2;
  border-radius: 999px;
  overflow: hidden;
}

.progress-bar {
  height: 100%;
  background: #003b8e;
  transition: width .4s ease;
}

/* action */
.action {
  margin-top: 12px;
}

.action button {
  width: 100%;
  padding: 10px;
  font-size: 14px;
  border-radius: 10px;
  border: none;
  background: #003b8e;
  color: #fff;
  font-weight: 600;
}

.checked {
  margin-top: 12px;
  background: #e6f4ea;
  color: #1e6b3a;
  padding: 10px;
  border-radius: 10px;
  font-size: 13px;
  text-align: center;
}

/* add button */
button.add {
  width: calc(100% - 32px);
  margin: 20px auto;
  display: block;
  padding: 14px;
  border-radius: 12px;
  border: none;
  font-size: 15px;
  background: #003b8e;
  color: white;
  font-weight: 600;
}

/* modal */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.3);
  display: flex;
  justify-content: center;
  align-items: flex-end;
}

.hidden { display: none; }

.sheet {
  background: #fff;
  width: 100%;
  max-width: 420px;
  padding: 20px;
  border-radius: 16px 16px 0 0;
}

.sheet h2 {
  margin: 0 0 12px;
  color: #003b8e;
}

label {
  display: block;
  margin-bottom: 14px;
  font-size: 13px;
  color: #555;
}

input {
  width: 100%;
  margin-top: 6px;
  padding: 12px;
  font-size: 16px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

.route {
  display: flex;
  align-items: flex-end;
  gap: 8px;
}

.route label { flex: 1; }

.route-arrow {
  padding-bottom: 14px;
  font-size: 18px;
  color: #003b8e;
}

.secondary {
  background: #eee;
  color: #333;
  margin-top: 8px;
}
</style>
</head>

<body>

<header>MY SCHEDULE</header>
<main id="list"></main>
<button class="add" onclick="openModal()">＋ 予定を追加</button>

<div id="modal" class="modal hidden">
  <div class="sheet">
    <h2>フライトを予約</h2>

    <div class="route">
      <label>出発地
        <input id="fromInput" placeholder="例：自宅">
      </label>
      <div class="route-arrow">→</div>
      <label>到着地
        <input id="toInput" placeholder="例：勉強">
      </label>
    </div>

    <label>出発時刻
      <input id="timeInput" type="time">
    </label>

    <label>所要時間（分）
      <input id="durationInput" type="number" placeholder="60">
    </label>

    <button onclick="submitFlight()">予約する</button>
    <button class="secondary" onclick="closeModal()">キャンセル</button>
  </div>
</div>

<script>
const flights = JSON.parse(localStorage.getItem("flights") || "[]");

function openModal(){ modal.classList.remove("hidden"); }
function closeModal(){ modal.classList.add("hidden"); }

function submitFlight() {
  if(!fromInput.value||!toInput.value||!timeInput.value||!durationInput.value) return;
  flights.push({
    id: Date.now(),
    from: fromInput.value,
    to: toInput.value,
    time: timeInput.value,
    duration: Number(durationInput.value),
    checkedIn: false
  });
  closeModal();
  save(); render();
}

function getState(f){
  const now = new Date();
  const [h,m]=f.time.split(":");
  const dep=new Date(); dep.setHours(h,m,0);
  const arr=new Date(dep.getTime()+f.duration*60000);
  const min=(dep-now)/60000;

  if(now>arr) return "arrived";
  if(now>=dep) return "inflight";
  if(min<=10) return "boarding";
  if(min<=30) return f.checkedIn?"checked":"checkin";
  return "reserved";
}

function progress(dep,arr){
  return Math.min(100,Math.max(0,(Date.now()-dep)/(arr-dep)*100));
}

function checkIn(id){
  const f=flights.find(x=>x.id===id);
  if(!f) return;
  f.checkedIn=true;
  save(); render();
}

function render(){
  list.innerHTML="";
  flights.forEach(f=>{
    const [h,m]=f.time.split(":");
    const dep=new Date(); dep.setHours(h,m,0);
    const arr=new Date(dep.getTime()+f.duration*60000);
    const state=getState(f);

    const labels={
      reserved:"予約済",
      checkin:"チェックイン可",
      checked:"チェックイン済",
      boarding:"搭乗中",
      inflight:"実行中",
      arrived:"到着"
    };

    let action="", prog="";
    if(state==="checkin"){
      action=`<div class="action"><button onclick="checkIn(${f.id})">チェックイン</button></div>`;
    }
    if(state==="checked"){
      action=`<div class="checked">✔ チェックイン済</div>`;
    }
    if(state==="inflight"){
      prog=`<div class="progress"><div class="progress-bar" style="width:${progress(dep,arr)}%"></div></div>`;
    }

    list.innerHTML+=`
      <div class="flight">
        <div class="flight-header">
          <div class="title">${f.from} → ${f.to}</div>
          <div class="status ${state}">${labels[state]}</div>
        </div>

        <div class="time-row">
          <div class="time-block">
            <div class="time">${dep.toTimeString().slice(0,5)}</div>
            <div class="label">出発</div>
          </div>
          <div class="arrow">→</div>
          <div class="time-block">
            <div class="time">${arr.toTimeString().slice(0,5)}</div>
            <div class="label">到着</div>
          </div>
        </div>

        <div class="sub">所要時間 ${f.duration}分</div>
        ${prog}
        ${action}
      </div>`;
  });
  save();
}

function save(){
  localStorage.setItem("flights",JSON.stringify(flights));
}

setInterval(render,10000);
render();
</script>

</body>
</html>
